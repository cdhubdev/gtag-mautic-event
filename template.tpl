___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "categories": [
    "MARKETING",
    "EMAIL_MARKETING"
  ],
  "securityGroups": [],
  "displayName": "CandidateHub Event",
  "brand": {
    "id": "brand_Suagencia",
    "displayName": "Suagencia",
    "thumbnail": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIACAYAAAD0eNT6AAAABHNCSVQICAgIfAhkiAAAFSNJREFUeJzt3VFuHFd6sOHvlEn13InAILkVswIxK1DPlRBRAPmvoMgVDLMCMyuwZgViryAkYHLgK1M7oFYQ6vYPBpDu0iJVJxds2bIjy5JF9unu73kAA7JhSx/hRtdbp05VRQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAoqrQdgeY22+/H7X09PJ+ftJgHgSwmArHb6jdF1bM3+bhwRESU2onZbH/xbW6XE/a/9o2qNNxFx8dM/KMNF1Hg9+7vziIjpWlzEyeT1//2vAbgLAmDFjbb7cdTYjBKbEd04SmyUiIeNx/pNNeLlTRwM51HjMkpcWl0AuH0CYIWMtvtxjdgq0W1Fia1FPtB/qVrjVURcRAwXEXEuCgC+jgBYYrNr8OOIblxKPGo7zfzVGi+iDBc14vzt95Pj1vMALBMBsERGj/vN+CbGUbrdiBjfxvX5VVJrnNQYzst1HE9/mFy2nmeV/PPf/1Fbz3DXao0X//3kz+PWcyyCDP+/3/v///bntMfBtdYD8Gmjx/1mXYvdUrq9VVrSvwulxE6JbifW47vR0/2XtQ5HYgDg4wTAgho96feidLs3BzW+VIl4WEr33fsYiGF4Nl2PY3caANwQAAtk9LjfjPU4iNrtWd6/PSXiYXTd8z+9i+d1e38y1OHZ1dnk4vf/S4DVJQAWwM1mvu6glNiJCDsz7lAp0X9Tur7b3n8RdTiank2OWs8E0IIAaGh24D/MuIO/tVLiUZTu0Wh7/zDqcCgEgGy61gNkNNrux6Pt/fNSuh8d/NsqJR6Urns+2t6/HD3p91rPAzAvVgDmaPS434y17shBf/GUEg+idM9HT/cPog4HHjQErDoBMA87/cboXRyW6P7aehQ+rUQ8jNL9ONreP4nr4cAthMCqcgngjt172u+OrrsLB//lUkrsxFp3cW+7P2g9C8BdsAJwV3b6jdF1d1QiduzqX06lxP0S3Xej7f3duB72rAYAq8QKwB0Ybffj0XV38dNtfSy1UuJRrHUXNgkCq0QA3LLRdn84293/oPUs3J5S4v7sboGj2Ok3Ws8D8LUEwG3Z6TdG2/vHpXTfth6Fu1NK9KN33fnocb/ZehaAryEAbsH6k35r9K47t+SfQ4l4GGvdxex1zABLSQB8pfUn/VZXunNv6sullLhfSvejfQHAshIAX+He0363K925F/fkVbruuQgAlpEA+INGT/q9Lrr/dPDnZnNgf9h6DoAvIQD+gNGTfq903fPWc7A4Sum+FQHAMhEAX2i03Y8d/PmYUrpvXQ4AloUA+ALrT/qtiO649RwsLnsCgGUhAD7T6HG/acMfn2O2J2Dceg6ATxEAn2On34j17tjBn8/XHd+sGAEsJgHwGWYv9XGfP5+tlLjfdZ3HBgMLSwD8jnvb/YEn/PFHlIiHo+vuqPUcAB8jAD5h9pS/71rPwfIqJXbubfcHrecA+DUB8Ft2+o2u2PHP1yvRHXp5ELBoBMBvGL2LQ6/05TaUEvdjzaUAYLEIgI8YbffjEt1fW8/B6iglHrkUACwSAfAxpXvWegRWj0sBwCIRAL9yb7s/cMsfd2F2KUBcAgtBAHxop98o0R22HoPVVUrseEogsAgEwAdmG/887Y87JjKB9gTAzOhxv2njH/NQSjy697TfbT0HkJsAeG/NWRnzU6q9AEBbAiBmZ/8l+tZzkEcp8cAqANCSAIiIWA/3ZzN3pXY+d0AzAmCn34ja7bUeg3xKiUfuCABaSR8Ao6vYtfOfdsQn0Eb6AIhi8x/tlBJ97PQbrecA8llrPUBL60/6LS/8+TI14mXUeB0REWW4+OnXv9CN3/+qlHg0n8mW173r2Hsb4a4AYK5SB0BXbML6lFrjRcRwHhHncR2X0x8ml3/oN9rpN0bXsVUjtkp044gYu+zysxLdQQgAYM5SB0BEuA3rA7XGm4g4rmU4fvv95PjWfuOTyetpxHnc/PUs4mb1petiL2q3m30VppR4sP6k37o6m1y0ngXII20A3Hva75ZwFhoRUWu8qjE8e7sWR3Ey+ciS/u2bHewOIuJg9KTfi9LtZb5c0HWxF+F2VGB+0gZAqd1ulNZTtHVzxj88m55ODlvOMT2bHEXE0c0tcd1RyhWB2u2GAADmKPNdAKmX/2uNF9O1YbP1wf9D09PJ+fT0+WaN4W+tZ5m395cBWs8B5JEyAEbbfepNaEMd/n16+nw8r+X+LzX9fnJQ6/CX2Z6ENEqJcesZgDxSBkBE3i/aOgz7b08nC7/jfHo6OR/qMM4UASW61KtSwHzlDICS84u2DsP+7Hr7Urg6m1xkioBS4pGHAgHzki8AdvqNEvGw9RjztmwH//eyRcC9d3lXp4D5ShcAo+tIt9Gq1pgs48H/vauzyUXUIcUO+VLzfT6BNtIFQCS7/l9rvJquLf/Bc3o2Oao1TlrPcfe6ceMBgCQSBkA3bjzAXNUyHCzqbv8vdj0crPqlgMwPQwLmK2EA5FlirTVe3OojfRu7eRfBsPB3MHwtzwMA5iFVAIwe95u57v8fDltPcNuma/Fs1VcBukSRCrSTKgDqep4v1lrj1fR0ct56jlt3czljZVY1PqrEZusRgNWXKgAy7bCuK7xUPtTV/dludOPGAwAJpAqAiG6z9QTz8nYtjlrPcFeuziYXNeJl6znu0GbrAYDVlywAcnyx1oiXK7Pz/zcN560nuCsp34YIzF2qAEhzi1UdVvsaeUREXe19ADevRga4O6kCIJHz1gPctZXc4AgwR2kCINMZVZaDY63xovUMd2jcegBgtaUJgCxWfHPcL5XhovUIAMsqTwDUHBsAo8Zl6xHmpa70z5rnjhWgjTwBkObhKnnOikvEKv+sm60HAFZbngBIokas+O1/Pxtqnp8V4LblCYASG61HmIcVPyv+hauzyer+rEk+r0A7eQKgdmkeA8zyKxEPW88ArLY8AQAA/EQAsNRW/dXAAHdFAKyYLA8B+sDq7gMAuEMCAAASEgAAkJAAAICEBAAAJCQAACAhAQAACQkAAEhIAABAQgIAABISAACQkAAAgIQEAAAkJAAAICEBAAAJCQAASEgAAEBCAgAAEhIAAJCQAACAhAQAACQkAAAgIQEAAAkJAABISAAAQEICAAASEgAAkJAAAICEBAAAJCQAACAhAQAACQkAAEhIAABAQgIAABJaaz0AfJUyXNSqYwG+lABgqU2/nxy0ngFgGTl1AoCEBAAAJCQAACAhAQAACQkAAEhIAABAQgIAABISAACQkAAAgIQEAAAkJAAAICEBAAAJCQAASEgAAEBCAgAAEhIAAJCQAACAhAQAACQkAAAgIQEAAAkJAABISAAAQEICAAASEgAAkJAAAICEBAAAJCQAACChtdYDACyIzX/6+z8OWw8B8yIAACKilHgQEd+2ngPmxSUAAEhIAABAQgIAABISAACQkAAAgIQEAAAkJAAAICEBAAAJCQAASEgAAEBCAgAAEhIAAJCQAACAhAQAACQkAAAgIQEAAAkJAABISAAAQEICAAASEgAAkJAAAICEBAAAJCQAACAhAQAACQkAAEhIAABAQgIAABISAACQkAAAgIQEAAAkJAAAICEBAAAJCQAASEgAAEBCAgAAEhIAAJCQAACAhAQAACQkAAAgIQEAAAkJAABISAAAQEICAAASWms9AMAiqDVe/PeTP49bz7EI/vnv/6itZ+DuWQEAgIQEAAAkJAAAICEBAAAJCQAASEgAAEBCAgAAEhIAAJCQAACAhAQAACQkAAAgIQEAAAkJAABISAAAQEICAAASEgAAkNBa6wHga4y2989LiUet57gL//P989J6BmB1WQEAgIQEAAAkJAAAICEBAAAJCQAASEgAAEBCAgAAEhIAAJCQAACAhAQAACQkAAAgIQEAAAkJAABISAAAQEICAAASEgAAkJAAAICEBAAAJCQAACAhAQAACQkAAEhIAABAQgIAABISAACQkAAAgIQEAAAkJAAAICEBAAAJCQAASEgAAEBCAgAAEhIAAJCQAACAhAQAACQkAAAgIQEAAAkJAABISAAAQEICAAASEgAAkJAAAICEBAAAJCQAACAhAQAACQkAAEhIAKyY9Sf9VusZ5izbzwtwKwTAiulKbLSeYZ5KifutZwBYRgIAABLKFACXrQeAz1VrvGo9A7DaEgXAcNl6gnmoia6Jr/h+h8vWAwCrLVEA5FAizx6AbPsdAG5TngCoWc6oulU+K/6FFV/tuGw9ALDa8gRASfKFWmKz9QjzUlb6Z81xyQpoJ08AJFEiHraeYW5qntUOgNuWJgCmp5Pz1jPMy2i7H7eeYR5KiUetZ7hD560HAFZbmgBIZtx6gLuWJXIA7kqqAKg1XrSeYT66ceMB5mHceoC7lGnFCmgjVQBExOvWA8xDKfEodvrVvkWudLutR7grtcab1jMAqy9ZAAwXrSeYl3vXsdd6hruy/qTfWvHNjmk+p0A7qQKgljxfrCW6g9Yz3JWurO7PFhERJU+oAu2kCoBylSgASjxYyY1yN5c2Vnb5PyIihjyfU6CdVAEw/WFymev6anfYeoLbNrqOg1V/BfDgEgAwB6kCYCbNl2sp8Wj0pN9rPcdtGT3uN0vpvm09x127Opuk+YwC7SQMgOG89QRzVbpnK3NHwFp31HqEu5bnVlWgtXQBkGkjYEREKXF/dL38B8572/3Bij/574YNgMCcpAuAt9/ke8RqKbEzeto/az3HHzXa7sdd6b5rPcc8VI8ABuYkXQDEyeR1jXjZeox5K9H9dRn3A6w/6bciuuPWc8xLxkAF2sgXABGRbh/ATOm65/e2+6W5h3525n++6rv+36s1XsTJJMXTKoH2cgZAjTRnlL/Wle670fb+0aJvDLy55t/9mOXgHxFRY0j7uQTmL2UATE8n57meB/BLpUQ/uu4uFvFBQaPH/eZoe/88yzX/D9Vq+R+Yn5QBMJP6bKuUeFBK9+Noe/949LjfbD1P7PQbo+3+sKx3/5Vit/+v1Bqv3P8PzFPaAKjFcmvEzR0CZb37r9H2/vG9p/3cH7G7/qTfGm3vH42uu8sMD/n5TT6PwJyttR6glbffT45H2/tvMl1j/pRSYqdEtzPa3n8VEee1DMdvv4nzu9iUNrv0MI7S7a74W/0+2zDEUesZgFzSBsDMcUT0rYdYJKXEg4joS3T9n95F1Kf7L6PGRcRwGbN71KdrcfE5YfB+j0GN2ColNqN2WxmX93+P5X+gheQBMBxFdALgE0rEwyjxcHa16NuIiD+9i4in+1/ye/zqF3yoxrC0D2kCllfaPQARP90N8Kr1HOT2ds3yPzB/qQMgwtkXbdUaEw//AVpIHwBv1+Io8zMBaG04aj0BkFP6AIiTyesovoSZv1rjxfR0ct56DiAnARARcRUuAzB/VXgC7QiAiJj+MLmsNSat5yCPWuPV9Gxy1HoOIC8B8N71cNh6BBKpPm9AWwJgZvrD5LLG8LfWc7D6ao0Xzv6B1gTAB6bfxKE7Arh7zv6B9gTAh04mr6svZ+5QrXFi5z+wCATAr7w9nTyrES9bz8HqqTXexPVw0HoOgAgB8HHVlzS3r8ZwOP1hctl6DoAIAfBR09PJuQ2B3KZa48Xb04nnTQALQwD8htmGQC8K4qvNlv73Ws8B8CEB8FtOJq+HOuy2HoPlZ+kfWEQC4BOuziYXQx3+vfUcLK9a48TSP7CIBMDveHs6eVZrnLSeg+VTI15O1yz9A4tJAHyG6dqw59ZAvkSt8WYYhr04mbxuPQvAxwiAz3EyeR1Xw66nBPL5ht2rs8lF6ykAfosA+EzTHyaXQx3GIoDfU4dh39P+gEUnAL7AbFPguPUcLK46DPte9AMsAwHwha7OJhd1GPZbz8HicfAHlokA+AOmZ5MjEcCHHPyBZSMA/qDp2eSo1uEv9gTg4A8sIwHwFaank3MbA3Nz8AeWlQD4Sldnk4u4HrY8JyCXWuPNu2H4Vwd/YFkJgFsw/WFyOf1mGHtiYA414mVcD1vu8weWmQC4LSeT19PT57veHbDaao3J9Jth7OU+wLITALfs7enk2bth+FevEl4ttcabIYb/Nz197vG+wEoQAHfg6mxyMV0btmoMf2s9C1+v1ngR18PW2+8nx61nAbgta60HWFknk9fTiIPRdn8c0R2VEg9aj8SXqTXe1BgOvc4XWEVWAO7Y9HRyPl0btmod/qP1LHy+WmMyXRs2HfyBVSUA5uFk8np6OjmsV8O/uFNgsdUaL2od/uJaP7DqXAKYo9nO8d3Rdj+O6A5LiUeNR2Km1nhVy3Dw9tR1fiAHAdDA7FWxYyHQXo14GcPwzAN9gGwEQEO/CoG9UqJvPFIatcaLiOFw9v8AIB0BsABmB6Hz0eP+MNZibxYD7hq4ZbXGmyjDUVzFMw/yAbITAAtkdlA6jIjDe0/73VK7vVJip+1Uy6/WOIk6HFvmB/iZAFhQs4fOHMdOvzG6it0o3a4Y+Hy1xosaw3G5jmNn+wD/lwBYdDcPFDqKiKPY6TfuvYtxqd1uRIxdJvjZ7JXM51GH4+l6HLuFD+DTSusB+OPWn/RbpcS4RDeOmyC433ai+Zkd8C8ihvOhxrE38wF8GQGwQkaP+834JsbRxVbUbmuVbi+sNV5EGS5iiIsh4sIBH+DrCIAVN3rcb8ZabEbEOKLbjIjNiNhaxNWCn8/q4zJiuKwlLuoQlw72ALdPACT2Pg5qiY1SYysiIkpsRO22fvqXSmyUiId/9M+oES+jxofX4y8jhsuIiFriotR4PdR47SAPAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHP3v+9hTxQAqOEjAAAAAElFTkSuQmCC"
  },
  "description": "Add page view or custom events in Mautic. Recommended to be used to trigger additional events, after initialization of mautic tracking (see Mautic with consent tag)",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "mautic_url",
    "displayName": "CandidateHub Domain",
    "simpleValueType": true
  },
  {
    "type": "TEXT",
    "name": "page_url",
    "displayName": "Page URL",
    "simpleValueType": true,
    "help": "include a custom string as the url, or leave it empty to use the original page\u0027s url"
  },
  {
    "type": "TEXT",
    "name": "page_title",
    "displayName": "Page Title",
    "simpleValueType": true,
    "help": "include a custom string as the page title, or leave it empty to use the original page\u0027s title"
  },
  {
    "type": "TEXT",
    "name": "tags",
    "displayName": "Tags",
    "simpleValueType": true,
    "help": "separate different tags with comma, use the minus sign to remove a tag (eg:  addThisTag,-removeThisTag)"
  },
  {
    "type": "PARAM_TABLE",
    "name": "public_fields",
    "paramTableColumns": [
      {
        "param": {
          "type": "TEXT",
          "name": "field_name",
          "displayName": "Field Name",
          "simpleValueType": true
        },
        "isUnique": true
      },
      {
        "param": {
          "type": "TEXT",
          "name": "field_value",
          "displayName": "Field Value",
          "simpleValueType": true
        },
        "isUnique": false
      }
    ],
    "displayName": "Update Public Fields",
    "help": "You can also pass information specific to your Contact by setting Mautic Contact field(s) to be publicly updatable."
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

// Enter your template code here.
const log = require('logToConsole');
const readTitle = require('readTitle');
const getUrl = require('getUrl');
const encodeUriComponent = require('encodeUriComponent');
const sendPixel = require('sendPixel');
log('data =', data);

const makeTableMap = require('makeTableMap' );



let pixelURL = ""; //data.mautic_url +"/mtacking.gif?";

pixelURL += "page_url=";
pixelURL += data.page_url == undefined?encodeUriComponent(getUrl()):encodeUriComponent(data.page_url);
pixelURL += "&page_title=";
pixelURL += data.page_title == undefined?encodeUriComponent(readTitle()):encodeUriComponent(data.page_title);

log(pixelURL);

if( data.tags !== undefined ) {
  pixelURL += "&tags=" + encodeUriComponent(data.tags);
}

if( data.public_fields !== undefined ) {
  const public_fields = makeTableMap(data.public_fields, "field_name","field_value");
  log(public_fields);
  for( let key in public_fields ){
    pixelURL += "&" + key +"=";
    pixelURL += encodeUriComponent(public_fields[key]);
  }
}
pixelURL = data.mautic_url +"/mtracking.gif?" + pixelURL;
log(pixelURL);
sendPixel(pixelURL);
// Call data.gtmOnSuccess when the tag is finished.
data.gtmOnSuccess();


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "all"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "send_pixel",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedUrls",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "read_title",
        "versionId": "1"
      },
      "param": []
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "get_url",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urlParts",
          "value": {
            "type": 1,
            "string": "any"
          }
        },
        {
          "key": "queriesAllowed",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "isRequired": true
  }
]


___TESTS___

scenarios:
- name: basic
  code: "const mockData = {\n  mautic_url:\"https://mkt.solutta.com\",\n  page_url:\"\
    page/test\",\n  page_title:\"Pagina Teste\",\n  tags:\"tag1,-tag2\",\n  public_fields:[\n\
    \    {field_name:\"field1\",field_value:\"value1\"},\n    {field_name:\"field2\"\
    ,field_value:\"value2\"},\n    {field_name:\"field3\",field_value:\"value3\"},\n\
    \     \n  ]\n};\n\n// Call runCode to run the template's code.\nrunCode(mockData);\n\
    \n// Verify that the tag finished successfully.\nassertApi('gtmOnSuccess').wasCalled();"
- name: NoPublicFields
  code: |-
    const mockData = {
      mautic_url:"https://mkt.solutta.com",
      page_url:"page/test",
      page_title:"Pagina Teste",
      tags:"tag1,-tag2",
    };

    // Call runCode to run the template's code.
    runCode(mockData);

    // Verify that the tag finished successfully.
    assertApi('gtmOnSuccess').wasCalled();


___NOTES___

Created on 1/4/2022, 11:27:10 PM


